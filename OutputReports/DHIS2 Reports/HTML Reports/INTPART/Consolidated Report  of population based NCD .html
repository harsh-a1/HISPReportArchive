<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<style>
td {
	border: 1px solid black;
     padding: 1px;
    text-align: center;
	 
}
#table1 {
    table-layout: auto;
	border-collapse: collapse;
	 border:none;
	 font-size:130%;
}
.emptyRow td {
	border:none;
}
.less{
    margin:0;
    padding:0;
}

</style>
</head>
<body>

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
   
Start Date:
  <input type="date" name="entry" id="start">
  End Date:
  <input type="date" name="exit" id="end">
   <button type="button" class="btn btn-success" id="getreport" style="font-size:20px;margin-left:100px;" onclick="getreportt()"><i class="fa fa-search"></i>  &nbsp&nbspNPCDCS  </button>
<!--<button style="font-size:24px;color:red;margin-left:450px;" onclick="abc()">Daily reminder  <i class="fa fa-clock-o"></i></button>-->
<a class="btn btn-danger" onclick="location.reload();" style='font-size:20px;color:white;margin-left:60px;'><i class="fa fa-trash-o fa-lg"></i> &nbsp&nbspClear</a>

<br>
<br>
<br>

<table id="table1" class="reporttable"   style="width:100%">
  
 
    </table>
   <script type="text/javascript" async>
      $.ajaxSetup({
        async: false
    });
	
	     var count=1;
	    var namee=[];
		var objresul=[];
		var objcontraception;
		var sex=[];
		var anmname=[];
		var objtrack=[];
		var housenumber;
		var objedd=[];
		var objmctsid=[];
		var objrefer;
		var objname=[];
		var objlmpadate=[];
		var objtrackcommon=[];
		var objid=[];
	    var objtrackhtn=[];
		var objtrackdm=[];
		var premature;
		var Cervical_CA=0;
		var objdate=[];
		var visitdate;
		var fem=0;
		var single_htn_dm=[];
		var single_htn=[];
		var single_dm=[];
		var objbothhtn_dm=[];
		var mal=0;
           var dm_fem=0;
		   var objtrackcommon_followup=[];
		   var visual_inspection=0;
          var dm_mal=0;		   
		var birthweight;
		var commonhtn_dm_fem_followup=0;
		var commonhtn_dm_mal_followup=0;
		var commonhtn_dm_mal=0;
		var commonhtn_dm_fem=0;
		var sexofinfant;
		var objbothhtn_dm_followup=[];
		var objmatchevent=[];
		var objahouseid=[];
		var Breast_examination=0;
		var Breast_CA=0;
		var objeventid=[];
		var htn_fem=0;
		var Oral_cavity_examination=0;
		var htn_fem_followup=0;
		var objtrackhtn_followup=[];
		var month_of_report;
		var dm_fem_follow=0;
		var htn_mal=0;
		var dm_mal_follow=0;
		var hbvalue;
		var objage=[];
		var dateobject=[];
		var objtrackdm_followup=[];
		var htn_mal_followup=0;
		var objtrack1=[];
		var housedetailss=["xalnzkNfD77","nHR1zCU0maL","Dnm1mq6iq2d","PbEhJPnon0o","kelN057pfhq","zLsKdtlBCIx"];
		var objatt=[];
		var objattribute=[];
		var basichouse=["AiPFBqutPYy","xalnzkNfD77"];
		var basicresult=["FnLijkR1Qku","meeJHik8FU4","D3ugBMt7BTp","RUmmHdBXikB"];
		var objanm=["yDCO4KM4WVA"];
		 function getreportt(){
		 dateobject.push("January","February","March","April","May","June","July","August","September","October","November","December");
		 var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
				var string1=startdatee.substring(5, 7);
				
				 if(string1.substring(0,1) =="0"){
    string1.substring(0,1).replace("0","");
	  var datedigit = parseInt(string1)-1;
	 // console.log(datedigit);
	  month_of_report=dateobject[datedigit];
      }
	  else{
	  var datedigit = parseInt(string1)-1;
	 // console.log(datedigit);
	  month_of_report=dateobject[datedigit];
	  
	  
	  }
	  
				
				
			
			// console.log(dateobject);
			 // console.log(startdatee);
			 
			  $.get("../api/trackedEntityInstances.json?ou=lZtSBQjZCaX&program=jC8Gprj4pWV&programStartDate="+startdatee+"&programEndDate="+enddatee+"&skipPaging=true", function (data1) {
			 
			var trackdata=data1;
              //  console.log(trackdata);
				
				for(var i=0;i<trackdata.trackedEntityInstances.length;i++)
				{
						// lengthentity=trackdata.trackedEntityInstances.length;
						objtrack.push(trackdata.trackedEntityInstances[i].trackedEntityInstance);
				var attributepath=trackdata.trackedEntityInstances[i].attributes; 
				 for(var q=0;q<attributepath.length;q++)
                    {
				if(attributepath[q].attribute=="PbEhJPnon0o")//sex
				{
				var gender=attributepath[q].value;
				if(gender=="Female")
				fem++;
				else if(gender=="Male")
				mal++;
				 }
			  
			  
				}
				}
			
			  });
				
				
				
				
				
				
				 
				
				
			     for(var j=0;j<objtrack.length;j++){
		 $.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=jC8Gprj4pWV&trackedEntityInstance="+objtrack[j]+"&&order=eventDate:asc&skipPaging=true", function (data) {
	
			var trackdata=data;
                //console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				if(matchevent=="YKX7e90j2DF") {
				
				if(trackdata.events[i].eventDate){
		           // visitdate=trackdata.events[i].eventDate.substring(0, 10);;
		        var eventdata=trackdata.events[i].dataValues;
				for(var q=0;q<eventdata.length;q++)
				   {
				   var id=eventdata[q].dataElement;
				  objid.push(id);
				   if(id=="GREEuTukX3P")//DM
				   {
				   
				    
					objtrackcommon.push("GREEuTukX3P"+ trackdata.events[i].trackedEntityInstance);
				   
				}
				else  if(id=="FSD6mDILc7l")//htn  
				   {
				   
				   objtrackcommon.push("FSD6mDILc7l"+ trackdata.events[i].trackedEntityInstance);
				  
					
				}
								else  if(id=="C4YdSPG3Mr0")//Breast CA   
				   {
				   
				   Breast_CA++;
				  
					
				}
							else  if(id=="RFEbDKwUpEG")//Visual inspection of Cervix
				   {
				   
				  var vall=eventdata[q].value;
		            	   
					if(vall=="Normal"||vall=="Abnormal"){
                               visual_inspection++;
				  console.log(trackdata.events[i].trackedEntityInstance);
				  }
					
				}
								else  if(id=="gpJWjauP93y")//Cervical CA
								{
				   
				   Cervical_CA++;
				  
					
				}
												else  if(id=="TWZIuOGpaRp")//Breast examination 
								{
				    var vall=eventdata[q].value;
		            	   
					if(vall=="Normal"||vall=="Abnormal"){
                               Breast_examination++;
				  //console.log(trackdata.events[i].trackedEntityInstance);
				  }
				  
				  
					
				}
											else  if(id=="m6K1sMyV9cM")//Breast examination 
								{
				    var vall=eventdata[q].value;
		            	   
					if(vall=="Normal"||vall=="Abnormal"){
                               Oral_cavity_examination++;
				  
				  }
				  
				  
					
				}
			
	       }
		  	 
          }
						
		   }
		}
		   });
		   if(objtrackcommon.length >0){
		     var compareid=objtrackcommon[0].substring(0, 11);
		   if(objtrackcommon.length==2)
		   objbothhtn_dm.push(objtrackcommon[1].substring( 11));
		 else if (compareid=="GREEuTukX3P")
		   objtrackdm.push(objtrackcommon[0].substring( 11));
		   else if (compareid=="FSD6mDILc7l")
		   objtrackhtn.push(objtrackcommon[0].substring( 11));
		   
		   objtrackcommon=[];
		   
		  }
		   }	
				 
				 
				 //new loop for common dm and htn 
				 
				 	  for(x=0;x<objbothhtn_dm.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+objbothhtn_dm[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				commonhtn_dm_fem++;
				else if(gender=="Male")
				commonhtn_dm_mal++;
				
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }
				   //new loop for  dm  
				   		 	  for(x=0;x<objtrackdm.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+objtrackdm[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				dm_fem++;
				else if(gender=="Male")
				dm_mal++;
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }
				  
				  //new for htn
				  		 	  for(x=0;x<objtrackhtn.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+objtrackhtn[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				htn_fem++;
				else if(gender=="Male")
				htn_mal++;
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }
				  // FOR FOLLOW UP DIAGNOSIS
				  
				  	 $.get("../api/events.json?orgUnit=lZtSBQjZCaX&programStage=mq26ujXKHI5&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
	
			var trackdata=data;
              //  console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				
				var matchevent=trackdata.events[i].programStage;
				if(matchevent=="mq26ujXKHI5") {
	
				
				if(trackdata.events[i].eventDate){
			
				
		        var eventdata=trackdata.events[i].dataValues;
				for(var q=0;q<eventdata.length;q++)
				   {
				   var id=eventdata[q].dataElement;
				 // objid.push(id);
				   if(id=="iztmNt3DVzX")//Follow up DM
				   {
				   var vall=eventdata[q].value;
		            	   
					if(vall=="true"){

					objtrackcommon_followup.push("iztmNt3DVzX"+ trackdata.events[i].trackedEntityInstance);
					//objeventid.push(trackdata.events[i].event);
					}
				}
				 else if(id=="MJxbfYLIRy5")//Follow up HTN
				   {
				   var vall=eventdata[q].value;
		            	   
					if(vall=="true"){

			 objtrackcommon_followup.push("MJxbfYLIRy5"+ trackdata.events[i].trackedEntityInstance);
				
					}
				}
				}
				}
				}
				 if(objtrackcommon_followup.length >0){
		     var compareid=objtrackcommon_followup[0].substring(0, 11);
		   if(objtrackcommon_followup.length==2)
		   objbothhtn_dm_followup.push(objtrackcommon_followup[1].substring( 11));
		 else if (compareid=="iztmNt3DVzX")
		   objtrackdm_followup.push(objtrackcommon_followup[0].substring( 11));
		   else if (compareid=="MJxbfYLIRy5")
		   objtrackhtn_followup.push(objtrackcommon_followup[0].substring( 11));
		   
		   objtrackcommon_followup=[];
		   
		  }
				
				}
				//console.log(objbothhtn_dm_followup);
					//console.log(objtrackdm_followup);
					//console.log(objtrackhtn_followup);
				});
	

    

			
    
    for(var i = 0;i < objbothhtn_dm_followup.length; i++){
        if(single_htn_dm.indexOf(objbothhtn_dm_followup[i]) == -1){
            single_htn_dm.push(objbothhtn_dm_followup[i])
        }
    }
				console.log();
    
    for(var i = 0;i < objtrackdm_followup.length; i++){
        if(single_dm.indexOf(objtrackdm_followup[i]) == -1){
            single_dm.push(objtrackdm_followup[i])
        }
    }
				
    
    for(var i = 0;i < objtrackhtn_followup.length; i++){
        if(single_htn.indexOf(objtrackhtn_followup[i]) == -1){
            single_htn.push(objtrackhtn_followup[i])
        }
    }
//console.log(single_htn_dm);
//console.log(single_htn);
//console.log(single_dm);



		 
				 //new loop for common dm and htn  follow up
				 
				 	  for(x=0;x<single_htn_dm.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+single_htn_dm[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				commonhtn_dm_fem_followup++;
				else if(gender=="Male")
				commonhtn_dm_mal_followup++;
				
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }

                      	   //new loop for  dm  
				   		 	  for(x=0;x<single_dm.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+single_dm[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				dm_fem_follow++;
				else if(gender=="Male")
				dm_mal_follow++;
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }
				  	  
				  //new for htn
				  		 	  for(x=0;x<single_htn.length;x++)
		  {
		  
	   var url1=  "../api/trackedEntityInstances/"+single_htn[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				 
				var gender=trackdata.attributes[q].value;
				if(gender=="Female")
				htn_fem_followup++;
				else if(gender=="Male")
				htn_mal_followup++;
				}
		
				 }
				 
				
					
				 		
				   
				  });
			
				  
				  
				  }


		              var facility="<tr style='border:1px solid black'>  <td  text-align='center' height='12px' colspan='3'> <b>PHD-25</b></td></tr>";
					 var healthfacilty="<tr style='border:1px solid black'>  <td  text-align='center' height='12px' colspan='3' contenteditable='true'> <b>Consolidated Report  of population based NCD screening for month of  "+month_of_report+"</b></td></tr>";
				
              var totalnumber="<tr style='border:1px solid black'>  <td>1</td>   <td>Total no of people above 30 yrs Screened for NCD's      :</td><td style='background-color:#F7F3F3'>(M:"+mal+",F:"+fem+")</td></tr>";
			  var dmonly="<tr style='border:1px solid black'>  <td>2.a)</td>   <td>No. of people diagnosed with DM only (New)                 :</td><td style='background-color:#F7F3F3'>(M:"+dm_mal+",F:"+dm_fem+")</td></tr>";
			   var dmonly_followup="<tr style='border:1px solid black'>  <td>b)</td>   <td>No. of People with DM on follow up                 :</td><td style='background-color:#F7F3F3'>(M:"+dm_mal_follow+",F:"+dm_fem_follow+")</td></tr>";
			  var htnonly="<tr style='border:1px solid black'>  <td>3.a)</td>   <td>No. of people diagnosed with HTN only (New)              :</td><td style='background-color:#F7F3F3'>(M:"+htn_mal+",F:"+htn_fem+")</td></tr>";
			  var htnonly_followup="<tr style='border:1px solid black'>  <td>b)</td>   <td>No. of people diagnosed with HTN on follow up              :</td><td style='background-color:#F7F3F3'>(M:"+htn_mal_followup+",F:"+htn_fem_followup+")</td></tr>";
			  var bothdmandhyn="<tr style='border:1px solid black'>  <td>4.a)</td>   <td>No. of people diagnosed with DM and HTN(both) only (New)         :</td><td style='background-color:#F7F3F3'>(M:"+commonhtn_dm_mal+",F:"+commonhtn_dm_fem+")</td></tr>";
			  var bothdmandhyn_followup="<tr style='border:1px solid black'>  <td>b)</td>   <td>No. of people diagnosed with DM and HTN(both)on follow up         :</td><td style='background-color:#F7F3F3'>(M:"+commonhtn_dm_mal_followup+",F:"+commonhtn_dm_fem_followup+")</td></tr>";
			  var suspected_oral="<tr style='border:1px solid black'>  <td>5</td>   <td>No. of people Screened for oral cancer           :</td><td style='background-color:#F7F3F3'>(M:"+mal+",F:"+fem+")</td></tr>";
			   var found_oral="<tr style='border:1px solid black'>  <td>a)</td>   <td> No suspected with oral cancer                  :</td><td style='background-color:#F7F3F3'>(M:0,F:0)</td></tr>";
			    var female_screened="<tr style='border:1px solid black'>  <td>6</td>   <td>. No of female screened for breast cancer        :</td><td style='background-color:#F7F3F3'>"+Breast_examination+"</td></tr>";
				 var found_screened="<tr style='border:1px solid black'>  <td>a)</td>   <td>No suspected with breast cancer            :</td><td style='background-color:#F7F3F3'>"+Breast_CA+"</td></tr>";
				  var cervical_cancer="<tr style='border:1px solid black'>  <td>7</td>   <td>No of female screened for Cervical cancer  :</td><td style='background-color:#F7F3F3'>"+visual_inspection+"</td></tr>";
				   var found_cervical="<tr style='border:1px solid black'>  <td>b)</td>   <td>No suspected with Cervical cancer        :</td><td style='background-color:#F7F3F3'>"+Cervical_CA+"</td></tr>";
			$(".reporttable").append(facility);
			$(".reporttable").append(healthfacilty);
				$(".reporttable").append(totalnumber);
				$(".reporttable").append(dmonly);
				$(".reporttable").append(dmonly_followup);
				$(".reporttable").append(htnonly);
				$(".reporttable").append(htnonly_followup);
				$(".reporttable").append(bothdmandhyn);
				$(".reporttable").append(bothdmandhyn_followup);
				$(".reporttable").append(suspected_oral);
				$(".reporttable").append(found_oral);
				$(".reporttable").append(female_screened);
				$(".reporttable").append(found_screened);
				$(".reporttable").append(cervical_cancer);
				$(".reporttable").append(found_cervical);
			
		    
		     }
		   
   </script>
  

  </body>
  </html>