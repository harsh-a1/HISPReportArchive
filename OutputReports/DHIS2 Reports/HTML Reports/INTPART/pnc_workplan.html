<!DOCTYPE html>
<html>
<head>

 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">


<style>
td {
	border: 1px solid black;
     padding: 1px;
    text-align: left;
	 
}
#table2 {
	table-layout: auto;
	 border-collapse: collapse;
	   
}
#table1 {
    table-layout: fixed;
	border-collapse: collapse;
	 border-top:none;
}
.less{
    margin:0;
    padding:0;
}
.emptyRow td {
	border:none;
}
button{
   
}
.modal-dialog {
	margin-top:150px;
}

#myInput {
  background-position: 10px 10px;
  background-repeat: no-repeat;
  width: 100%;
  font-size: 16px;
  padding: 12px 20px 12px 40px;
  border: 1px solid #ddd;
  margin-bottom: 12px;
}





</style>
</head>
<body>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	 <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    
   Start Date:
  <input type="date" name="entry" id="start">
  End Date:
  <input type="date" name="exit" id="end">
<!--Select Date: <input type="date" id="Start" name="FirstName" ><br>-->
 <button type="button" class="btn btn-success" id="getreport" style="font-size:20px;margin-left:450px;" onclick="getreportt()"><i class="fa fa-search"></i>  &nbsp&nbspPNC Work Plan </button>
<!--<button style="font-size:24px;color:red;margin-left:450px;" onclick="abc()">Daily reminder  <i class="fa fa-clock-o"></i></button>-->
<a class="btn btn-danger" onclick="location.reload();" style='font-size:20px;color:white;margin-left:60px;'><i class="fa fa-trash-o fa-lg"></i> &nbsp&nbspClear</a>

</br>
<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport"><span class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span> &nbsp;
    Download As Excel
</button>
</br>
</br>
<p id="click-response"></p>
<input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for anm names.." title="Type in a name">
<table id="table1" class="reporttable"   style="width:100%">
  
 
    </table>
	
	</body>
    	
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>

	<script type="text/javascript" async>
      $.ajaxSetup({
        async: false
    });
	
	     var count=0;
	    var namee=[];
		var objresul=[];
		var objcontraception;
		var sex=[];
		var anmname=[];
		var objtrack=[];
		var incentDate=[];
		var housenumber;
		var objanmname=[];
			var objdate=[];
		var objhouse=[];
		var objrefer;
		var objname=[];
		var objid=[];
		var objmatchevent=[];;
		var objahouseid=[];
		var objage=[];
		var objfinaldate=[];
		var objtrack1=[];
		var objlocality=[];
		var housedetailss=["xalnzkNfD77","nHR1zCU0maL","Dnm1mq6iq2d","PbEhJPnon0o","kelN057pfhq","zLsKdtlBCIx"];
		var objatt=[];
		var objattribute=[];
		var basichouse=["YFjB0zhySP6","xalnzkNfD77","NG0XocGDXZp","MV4wWoZBrJS","yDCO4KM4WVA"];
		var basicresult=["FnLijkR1Qku","wUfbKKnxLLn"];
		var objanm=["yDCO4KM4WVA"];
	  
	
			 function clearr()
			 {
		window.location.reload;
			 }
	
	

   

     function getreportt(){
     
	 
					 var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;

				

			$.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
	
			var trackdata=data;
                console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				//var duee=trackdata.events[i].dueDate;    
				
				 if(matchevent=="u0c2uIZBvks")  //Delivery stage ********************   
				{
				
				 var eventdata=trackdata.events[i].dataValues;
				 if(eventdata.length >1){
				 objtrack.push(trackdata.events[i].trackedEntityInstance);
				     var aa=trackdata.events[i].eventDate.substring(0,10);
					 function addDays(n,staticdate){
					var t = new Date(staticdate);
					t.setDate(t.getDate() + n); 
					var month = "0"+(t.getMonth()+1);
					 date = "0"+t.getDate();
					month = month.slice(-2);
					date = date.slice(-2);
					var resultdate = t.getFullYear(); 
	               resultdate=resultdate +"-"+month +"-"+date;
					objdate.push(resultdate);
					//console.log(objdate);
				   }
				var staticdate=aa;

				addDays(1,staticdate);// 1 day
				addDays(3,staticdate);// 3 day
				addDays(7,staticdate);// 7  day
				addDays(14,staticdate);// 14 day  
				addDays(21,staticdate);// 21 day  
				addDays(28,staticdate);// 28 day
				addDays(42,staticdate);// 42 day
				
				
				objfinaldate.push(objdate);
				  objdate=[];
					 
				   
				 }
							
				}
				
				}
				});
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				for(var g=0;g<objtrack.length;g++)
				{
				
		 $.get("../api/trackedEntityInstances/"+objtrack[g]+".json?&skipPaging=true", function (data1) {
			  var trackdata=data1;
			 
			  			  for(var i=0;i<trackdata.attributes.length;i++)
				{
			 
			   var attributepath=trackdata.attributes[i].attribute; 
			 //  objtrack.push(trackdata.trackedEntityInstances[i].trackedEntityInstance);
			 
					objattribute.push(attributepath);
				  
				if(attributepath=="YFjB0zhySP6")//household
				  {
				var aa=trackdata.attributes[i].value;
				
				//housenumber=aa;
				objhouse.push(aa);
			
				 
				 }
				 else if(attributepath=="xalnzkNfD77")//Name of woman
				  {
				var aa=trackdata.attributes[i].value;
				
				//nameofwoman=aa;
				objname.push(aa);
			
				 
				 }
				  else if(attributepath=="MV4wWoZBrJS")//Locality
				  {
				var aa=trackdata.attributes[i].value;
				
				//nameofwoman=aa;
				objlocality.push(aa);
			
				 
				 }
				 else if(attributepath=="yDCO4KM4WVA")//anm name 
				  {
				var aa=trackdata.attributes[i].value;
				
				//nameofwoman=aa;
				objanmname.push(aa);
			
				 
				 }
				
			 
				  
			   }
			    var array3 = basichouse.filter(function(obj) { return objattribute.indexOf(obj) == -1; });
		          for(var t=0;t<array3.length;t++)
					{
					if(array3[t]=="YFjB0zhySP6")
				      objhouse.push("NA");
					else if(array3[t]=="xalnzkNfD77")
					objname.push("NA");
					else if(array3[t]=="MV4wWoZBrJS")
					objlocality.push("NA");
					else if(array3[t]=="yDCO4KM4WVA")
					objanmname.push("NA");
				
					
					}
					
				 		objattribute=[];
			    }); 
				
				}
			
               var header="<tr style='border:1px solid black;background-color:#fff2cc;'>  <th> S.no </th> <th> State</th>   <th> Name</th><th>Locality</th><th>ANM Name</th><th>House No</th><th>At 1 day</th><th>At 3 days</th><th>At 7 days</th><th>At 14 days</th><th>At 21 days</th><th>At 28 days</th><th>At 42 days</th></tr>";
				
			
				$(".reporttable").append(header);
				
				
				
				
				
				
				
		     for(var j=0;j<objtrack.length;j++){
			
		 $.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&trackedEntityInstance="+objtrack[j]+"&order=eventDate:asc", function (data) {
	
			var trackdata=data;
               // console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				if(matchevent=="DEwcVnLljOB") {
				
				if(trackdata.events[i].eventDate){
				 
				 objmatchevent.push(trackdata.events[i].eventDate.substring(0,10));
				 }
				}
		         
		   }
		 var length_ovjmatchevent=objmatchevent.length;
		     var pushresult=7-parseInt(length_ovjmatchevent);
			 
			 for(var l=0;l<pushresult;l++)
			 {
			 objmatchevent.push("&nbsp&nbsp&nbsp");
			 }
		      
		   
		   });
		    var idealstate="<tr style='border:1px solid black;background-color:#ccffcc'>  <td> "+j+"</td> <td style='background-color:#79ff4d'> ideal</td>   <td> "+objname[j]+"</td><td>"+objlocality[j]+"</td><td>"+objanmname[j]+"</td><td>"+objhouse[j]+"</td><td>"+objfinaldate[j][0]+"</td><td>"+objfinaldate[j][1]+"</td><td>"+objfinaldate[j][2]+"</td><td>"+objfinaldate[j][3]+"</td><td>"+objfinaldate[j][4]+"</td><td>"+objfinaldate[j][5]+"</td><td>"+objfinaldate[j][6]+"</td></tr>";
				
		  var res="<tr style='border:1px solid black'>  <td> "+j+"</td> <td style='background-color:#4dc3ff'> Running</td>   <td> "+objname[j]+"</td><td>"+objlocality[j]+"</td><td>"+objanmname[j]+"</td><td>"+objhouse[j]+"</td><td>"+objmatchevent[0]+"</td><td>"+objmatchevent[1]+"</td><td>"+objmatchevent[2]+"</td><td>"+objmatchevent[3]+"</td><td>"+objmatchevent[4]+"</td><td>"+objmatchevent[5]+"</td><td>"+objmatchevent[6]+"</td></tr>";
				
			     $(".reporttable").append(idealstate);
				$(".reporttable").append(res);
			  objmatchevent=[];
		   }
		    
		    } 
			
				   function myFunction() {
  var input, filter, table, tr, td, i;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  table = document.getElementById("table1");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[4];
    if (td) {
      if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}
		   
		     $("#btnExport").click(function (e) {
                var a = document.createElement('a');
                var data_type = 'data:application/vnd.ms-excel';
                var table_div = document.getElementById('table1');
                var table_html = table_div.outerHTML.replace(/ /g, '%20');
                a.href = data_type + ', ' + table_html;
                a.download = 'PncVisist.xls';
                a.click();
                e.preventDefault();
            });		
				
				
				
	

	</script>
	
	

	
	</html>