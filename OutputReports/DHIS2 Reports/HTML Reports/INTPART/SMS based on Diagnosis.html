<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
td {
	border: 1px solid black;
     padding: 1px;
    text-align: center;
	 
}
#table1 {
    table-layout: auto;
	border-collapse: collapse;
	 border:none;
}
.emptyRow td {
	border:none;
}
.less{
    margin:0;
    padding:0;
}
.emptyRow td {
	border:none;
}
textarea {    
    position: absolute;
    left: 30px;
}
</style>
</head>
<body>
Start Date:
  <input type="date" name="entry" id="start">
  End Date:
  <input type="date" name="exit" id="end">
 <button type="button"  id="myBtn" class="btn btn-info"  onclick="dm('dm');">DM</button>              
 <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('htn');">HTN</button>        
  <button type="button"  id="myBtn" class="btn btn-info"   style='margin-left:25px;' onclick="dm('copd');">COPD</button>   
    <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('cvd1');">CVD1</button>
 <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;' onclick="dm('ca-other');">CA-Other</button> 
 <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;' onclick="dm('rf');">RF</button>  
 <button type="button"  id="myBtn" class="btn btn-info"   style='margin-left:25px;' onclick="dm('ckd');">CKD</button>  
   <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('oral_ca');">Oral CA</button>  
   <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('cervical_ca');">Cervical CA</button>
    <button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('breast_ca');">Breast CA</button>
	<button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="childhealthdata();">Penta 3</button>

<button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="dm('tobacooi');">Child</button>

<button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="tbprogramdata();">TB</button>

<button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;margin-top:10px'  onclick="anemic_not_delivered();">Anemia</button>

<button type="button"  id="myBtn" class="btn btn-info"  style='margin-left:25px;'  onclick="ANC_1st_Visit();">ANC 1st</button>
	</br>
</br>
<textarea id="test" rows="6" placeholder='Type the Sms content' cols="55">

</textarea>
</br>
</br>
</br>
</br>
</br>
</br>    

</br>
</br>
</br>
</br>
<a href="http://www.hindietools.com/2016/05/html-entity-to-unicode-unicode-to-html.html">CONVERT TO HTML ATTRIBUTE</a>
</br>
</br>
<table id="table1" class="report"   style="width:100%">
  
 
    </table>
	<script>
	
	</script>
	
   <script type="text/javascript" async>
   var smscontent;
   var objatt=[];
    var namee=[];
	var familyuniqueid=[];
	var mobile=[];
	var sex=[];
	var objtrackinstance=[];
	var housedetailss=["xalnzkNfD77","nHR1zCU0maL","Dnm1mq6iq2d","PbEhJPnon0o","kelN057pfhq","zLsKdtlBCIx","Lt9ZrfgAMuw"];
	var objdiagnosis=[];
	var single_tei=[];
	var single_tei_anc=[];
	 
   //var  mobileee=["8968999927","NA","9650597410","NA"];
     	 $.ajaxSetup({
        async: false
    });
	 var unicodeString = '';  
	    function dm(dmm){
		var show_case=dmm;
		//alert(dmabc);
	   var Table = document.getElementById("table1");
        Table.innerHTML = "";
	     var count=1;
	   
		var objid=[];
		
		var adharnumber=[];
		
		
		var housenumber;
		var objhouse=[];
		var objcheck=[];
		
		var objtrack1=[];
		
		
		var objatt=[];
		var objattribute=[];
		var basichouse=["ZQMF7taSAw8","p6cLzDqCy0c","Q3FM5tnqXwm","caLxHmzEsxO","gfdru4cqZS0","LQi7veXJQ5D","gu2sb8mD9sR"];
		var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
				
		   	 $.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=jC8Gprj4pWV&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data22) {
	
			var eventdata=data22;
                console.log(eventdata);
				for(var j=0;j<eventdata.events.length;j++)
				{
				
				var matchevent=eventdata.events[j].programStage;
				
				if(matchevent=="YKX7e90j2DF"){
				if(eventdata.events[j].eventDate){
				   var dataval=eventdata.events[j].dataValues;
				   var trackinstanceid=eventdata.events[j].trackedEntityInstance;
				   for(var q=0;q<dataval.length;q++)
				   {
				   var id=dataval[q].dataElement;
				  objid.push(id);
				   if(id=="FSD6mDILc7l")
				   {
				if(show_case=="htn"){
				   objcheck.push(id);
				 
				objdiagnosis.push("HTN");
					 }
				   }
				   else if(id=="C4YdSPG3Mr0"){  
				    if(show_case=="breast_ca"){
				   objcheck.push(id);
				  
				objdiagnosis.push("Breast CA");
				}
				   }
				   
				   else if(id=="gpJWjauP93y"){  
                        if(show_case=="cervical_ca"){				  
				  objcheck.push(id);		 
				objdiagnosis.push("Cervical CA");
				}
				   }
				   
				   else if(id=="ObkhLek0zZf"){
				   if(show_case=="oral_ca"){
				   objcheck.push(id);
				objdiagnosis.push("Oral CA");
				   }
				   }
				   
				   else if(id=="Fay65bFZIkC"){ 
				      if(show_case=="ckd"){
				   objcheck.push(id);
				
				objdiagnosis.push("CKD");
				}
				   }
				   
				   else if(id=="xFhzzBJ4Z6K"){  
				   if(show_case=="rf"){
				   objcheck.push(id);
				   
				objdiagnosis.push("RF");
				}
				   }
				   else if(id=="doZmhIPTR2O"){  
				   if(show_case=="copd"){
				   objcheck.push(id);
				   
				objdiagnosis.push("COPD");
				}
				   }
				    if(id=="GREEuTukX3P"){
					if(show_case=="dm"){
				   objcheck.push(id);
				 count++;
				objdiagnosis.push("DM");
				}
				   }
				   else if(id=="m63ulx9T3Ri"){   
				   if(show_case=="cvd1"){
				   objcheck.push(id);
				    
				objdiagnosis.push("CVD1");
				}
				   }
				    else if(id=="Ssnvxn9jJwd"){   // tobacoo
				   if(show_case=="tobacooi"){
				   var vall=dataval[q].value;
				   if(vall=="true"){
				   objcheck.push(id);
				    
				objdiagnosis.push("tobacoo");
				}
				}
				   }
				    else if(id=="kN3pAy7tNSh"){   // tobacoo
				   if(show_case=="tobacooi"){
				   var vall=dataval[q].value;
				   if(vall=="true"){
				   objcheck.push(id);
				    
				objdiagnosis.push("tobacoo");
				}
				}
				   }
				   else if(id=="bv7PMXbyOZD"){  
				    if(show_case=="ca-other"){
				   objcheck.push(id);
				   
				objdiagnosis.push("CA-Other");
				}
				   }
				   }
				     if(objcheck.length>0){
				   objtrackinstance.push(trackinstanceid);
				   objcheck=[];
				   }
				   }
				   }
				   }
				   
				 console.log(objtrackinstance.length);
				 console.log("in loop"+count);
			  });
		 
	
		
		
		var smsbutton="<tr class='emptyRow' style='height:20px'><td></td><td></td><td></td><td></td><td></td><td><input type='button' id='btn' value='Send Sms'/></td></tr>";
		        
               var aadress="<tr style='border:1px solid black;background-color:orange;height:30px'><td>S.No</td><td> Name</td><td>Faimily_id</td><td>Sex</td><td>Mobile Number</td><td>Diagnosis</td></tr>";
		        
				  $(".report").append(smsbutton);
				 $(".report").append(aadress);
				 document.getElementById("btn").addEventListener("click", function() {
    sendsmss(mobile);
}, false);
            get_tei_value(objtrackinstance);
			
			}
			
			
			
			//function for child health 
			function childhealthdata(){
		// child health api.....
		var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
				
			  $.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=JdZ3gv6cx54&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
                 var trackdata=data;
                console.log(trackdata);
                for(var i=0;i<trackdata.events.length;i++)
				{		
		        var eventdata=trackdata.events[i].dataValues; 
                var trackinstanceid=trackdata.events[i].trackedEntityInstance;			
				for(var q=0;q<eventdata.length;q++)
				   {
				   var id=eventdata[q].dataElement;
				   
					
					
					    if(id=="bLJEYJvjbtF")// DPT/Penta 3   
				   {
				   
				   
				   var vall=eventdata[q].value;
				   if(vall=="true"){
				  objtrackinstance.push(trackinstanceid);
				  objdiagnosis.push("Penta 3");
				  }
				  
                       }
					
					
					   }
		             
					  }
					  });
					 	var smsbutton="<tr class='emptyRow' style='height:20px'><td></td><td></td><td></td><td></td><td></td><td><input type='button' id='btn' value='Send Sms'/></td></tr>";
		        
               var aadress="<tr style='border:1px solid black;background-color:orange;height:30px'><td>S.No</td><td> Name</td><td>Faimily_id</td><td>Sex</td><td>Mobile Number</td><td>Diagnosis</td></tr>";
		        
				  $(".report").append(smsbutton);
				 $(".report").append(aadress);
				 document.getElementById("btn").addEventListener("click", function() {
    sendsmss(mobile);
}, false);
            get_tei_value(objtrackinstance); 
					  
		
		
		}
			
			//function for tb program 
			function tbprogramdata(){
		// child health api.....
		var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
				
			  $.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=qAeWjN7Iqi7&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
                 var trackdata=data;
                console.log(trackdata);
                for(var i=0;i<trackdata.events.length;i++)
				{		
				var matchevent=trackdata.events[i].programStage;
				
				if(matchevent=="hi4UhKtesxm"){
				if(trackdata.events[i].eventDate){
                var trackinstanceid=trackdata.events[i].trackedEntityInstance;	
               var eventdata=trackdata.events[i].dataValues; 				
				for(var q=0;q<eventdata.length;q++)
				   {
				   var id=eventdata[q].dataElement;
				   
					
					
					    if(id=="v9pO1CPPwES")//Pretreatment sputum examination 
				   {
				   
				   
				   var vall=eventdata[q].value;
				   var tbvalue=vall;
				 
				  
                       }
					
					
					   }
					     if(tbvalue!=="true"){
				  objtrackinstance.push(trackinstanceid);
				  objdiagnosis.push("Tb");
				  }
				  tbvalue="";
					   }
		             }
					  }
					  });
					 	var smsbutton="<tr class='emptyRow' style='height:20px'><td></td><td></td><td></td><td></td><td></td><td><input type='button' id='btn' value='Send Sms'/></td></tr>";
		        
               var aadress="<tr style='border:1px solid black;background-color:orange;height:30px'><td>S.No</td><td> Name</td><td>Faimily_id</td><td>Sex</td><td>Mobile Number</td><td>Diagnosis</td></tr>";
		        
				  $(".report").append(smsbutton);
				 $(".report").append(aadress);
				 document.getElementById("btn").addEventListener("click", function() {
    sendsmss(mobile);
}, false);
            get_tei_value(objtrackinstance); 
					  
		
		
		}
			
			
			
			
			function anemic_not_delivered(){
				var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
			
			$.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
	
			var trackdata=data;
                console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				
				if(matchevent=="aAmtHNAQo7g" && trackdata.events[i].enrollmentStatus=="ACTIVE") {  //ANC First visist
				   
				if(trackdata.events[i].eventDate){
				 var trackinstanceid=trackdata.events[i].trackedEntityInstance;	
				
				 	   var dataval=trackdata.events[i].dataValues;
				   for(var q=0;q<dataval.length;q++)
				   {
				   var id=dataval[q].dataElement;
				  
				  
				  if(id=="yka2bblmdbM")// HB(gm)
				   {
				
				   var vall=dataval[q].value;
				   var hbgm_first=vall;
				   if(hbgm_first<11){
				   objtrackinstance.push(trackinstanceid);
				   }
		             
					 
					 
				   }
			  }
			 
				 }
			
				}
				else if(matchevent=="WMnWjG8PS58" && trackdata.events[i].enrollmentStatus=="ACTIVE") {            // ANC SECOND VISIT
				if(trackdata.events[i].eventDate){
				var trackinstanceid=trackdata.events[i].trackedEntityInstance;	
				 	   var dataval=trackdata.events[i].dataValues;
				   for(var q=0;q<dataval.length;q++)
				   {
				   var id=dataval[q].dataElement;
				 
				    if(id=="XI9R4MyF4cP")// hb value 2nd visit
				   {
				
				   var vall=dataval[q].value;
		            if(vall<11){
				   objtrackinstance.push(trackinstanceid);
				   }
				   }
				   else if(id=="RMGf5pzvlGN")// hb value 3rd visit
				   {
				
				   var vall=dataval[q].value;
		            if(vall<11){
				   objtrackinstance.push(trackinstanceid);
				   }
				   }
				   else if(id=="HkOHsdUuQSl")// hb value 4th visit
				   {
				
				   var vall=dataval[q].value;
		            if(vall<11){
				   objtrackinstance.push(trackinstanceid);
				   }
				   }
				   
			  }
			
				 }
			
				}
		         
		   }
	
			var smsbutton="<tr class='emptyRow' style='height:20px'><td></td><td></td><td></td><td></td><td></td><td><input type='button' id='btn' value='Send Sms'/></td></tr>";
		        
               var aadress="<tr style='border:1px solid black;background-color:orange;height:30px'><td>S.No</td><td> Name</td><td>Faimily_id</td><td>Sex</td><td>Mobile Number</td><td>Diagnosis</td></tr>";
		        
				  $(".report").append(smsbutton);
				 $(".report").append(aadress);
				 document.getElementById("btn").addEventListener("click", function() {
    sendsmss(mobile);
}, false);
            filter_delivery(objtrackinstance); 
			  	 
		      
		   
		   });
			
			
			
			
			}
			
			
			function filter_delivery(objtrackinstance){		
			//remove duplicates
			var filter_teiobj=objtrackinstance;
			 for(var i = 0;i < filter_teiobj.length; i++){
        if(single_tei.indexOf(filter_teiobj[i]) == -1){
            single_tei.push(filter_teiobj[i])
        }
    }
	
	objtrackinstance=[];
	//api for checking where tei has delivery stage filled ...
	        for(var p=0;p<single_tei.length;p++){
	$.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&trackedEntityInstance="+single_tei[p]+"&&order=eventDate:asc&skipPaging=true", function (data) {
	
			var trackdata=data;
                //console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				
				if(matchevent=="u0c2uIZBvks" && trackdata.events[i].enrollmentStatus=="ACTIVE") {  //ANC First visist
			   var check_event_status=trackdata.events[i].status;
			      if(check_event_status=="SCHEDULE"){
				  var trackinstanceid=trackdata.events[i].trackedEntityInstance;
				  objtrackinstance.push(trackinstanceid);
				  objdiagnosis.push("Anemia");
				  }
			
				}
				
		         
		   }
	
		
           
			  	 
		      
		   
		   });
		   }
	            
			 get_tei_value(objtrackinstance); 
			
			}
			
			
			function ANC_1st_Visit(){
				var startdatee=document.getElementById('start').value;
				var enddatee=document.getElementById('end').value;
			
			$.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&startDate="+startdatee+"&endDate="+enddatee+"&skipPaging=true", function (data) {
	
			var trackdata=data;
                console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				
				if(matchevent=="aAmtHNAQo7g" && trackdata.events[i].enrollmentStatus=="ACTIVE") {  //ANC First visist
				   
				if(trackdata.events[i].eventDate){
				 var trackinstanceid=trackdata.events[i].trackedEntityInstance;	
				
				 	
				   objtrackinstance.push(trackinstanceid);
				 
			 
				 }
			
				}
				
		         
		   }
	
			var smsbutton="<tr class='emptyRow' style='height:20px'><td></td><td></td><td></td><td></td><td></td><td><input type='button' id='btn' value='Send Sms'/></td></tr>";
		        
               var aadress="<tr style='border:1px solid black;background-color:orange;height:30px'><td>S.No</td><td> Name</td><td>Faimily_id</td><td>Sex</td><td>Mobile Number</td><td>Diagnosis</td></tr>";
		        
				  $(".report").append(smsbutton);
				 $(".report").append(aadress);
				 document.getElementById("btn").addEventListener("click", function() {
    sendsmss(mobile);
}, false);
            filter_anc_second(objtrackinstance); 
			  	 
		      
		   
		   });
			
			
			
			
			}
			
				
			function filter_anc_second(objtrackinstance){		
			//remove duplicates
			var filter_teiobj=objtrackinstance;
			 for(var i = 0;i < filter_teiobj.length; i++){
        if(single_tei_anc.indexOf(filter_teiobj[i]) == -1){
            single_tei_anc.push(filter_teiobj[i])
        }
    }
	
	objtrackinstance=[];
	//api for checking where tei has delivery stage filled ...
	        for(var p=0;p<single_tei_anc.length;p++){
	$.get("../api/events.json?orgUnit=lZtSBQjZCaX&program=SUCUF657zNe&trackedEntityInstance="+single_tei_anc[p]+"&&order=eventDate:asc&skipPaging=true", function (data) {
	
			var trackdata=data;
                //console.log(trackdata);
				 
				for(var i=0;i<trackdata.events.length;i++)
				{
				var matchevent=trackdata.events[i].programStage;
				
				if(matchevent=="WMnWjG8PS58" && trackdata.events[i].enrollmentStatus=="ACTIVE") {  //ANC First visist
			   var check_event_status=trackdata.events[i].status;
			      if(check_event_status=="SCHEDULE"){
				  var trackinstanceid=trackdata.events[i].trackedEntityInstance;
				  objtrackinstance.push(trackinstanceid);
				  objdiagnosis.push("ANC");
				  }
			
				}
				
		         
		   }
	
		
           
			  	 
		      
		   
		   });
		   }
	            
			 get_tei_value(objtrackinstance); 
			
			}
			
			
			
			
			 function get_tei_value(objtrackinstance){
		  for(x=0;x<objtrackinstance.length;x++)
		  {
	   var url1=  "../api/trackedEntityInstances/"+objtrackinstance[x]+".json?";
         $.get(url1, function (data1) {
			 
			var trackdata=data1;
               // console.log(trackdata);
					
				
				 for(var q=0;q<trackdata.attributes.length;q++)
                    {
					var idd =trackdata.attributes[q].attribute;
					// objatt.push(idd);	
					 objatt.push(idd);
				if(trackdata.attributes[q].attribute=="xalnzkNfD77")//name of family member
				{
				 
				var aa=trackdata.attributes[q].value;
				 namee.push(aa);
				
				}
				if(trackdata.attributes[q].attribute=="PbEhJPnon0o")//sex
				{
				
				var aa=trackdata.attributes[q].value;
				sex.push(aa);
				
				}
				if(trackdata.attributes[q].attribute=="Lt9ZrfgAMuw")//mobile number
				{
				
				var aa=trackdata.attributes[q].value;
				mobile.push(aa);
				
				}
				if(trackdata.attributes[q].attribute=="Dnm1mq6iq2d")//family unique id
				{
				
				var aa=trackdata.attributes[q].value;
				familyuniqueid.push(aa);
				
				}
				 }
				  var array3 = housedetailss.filter(function(obj) { return objatt.indexOf(obj) == -1; });
		          for(var t=0;t<array3.length;t++)
					{
					if(array3[t]=="xalnzkNfD77") 
				      namee.push("NA");
					else if(array3[t]=="Dnm1mq6iq2d")
					familyuniqueid.push("NA");
					else if(array3[t]=="PbEhJPnon0o")
					sex.push("NA");
					else if(array3[t]=="Lt9ZrfgAMuw")  
					mobile.push("NA");
					
					
					}
					
				 		objatt=[];
				   
				 
				 		//objatt=[];
				   
				  });
				   var result="<tr style='border:1px solid black;background-color:white;'><td>"+x+"</td><td>"+namee[x]+"</td><td>"+familyuniqueid[x]+"</td><td>"+sex[x]+"</td><td>"+mobile[x]+"</td><td>"+objdiagnosis[x]+"</td></tr>";
		        
				 
				 $(".report").append(result);
				  }
				
	
				}
			
	function sendsmss(mobile){

	 smscontent= document.getElementById('test').value;
 var finalcontent = encodeURIComponent(smscontent);

var smsurl = "http://msdgweb.mgov.gov.in/esms/sendsmsrequest?username=PHD25PGIMER&password=sph@25&smsservicetype=unicodemsg&content="+finalcontent+"&mobileno="+mobile+"&senderid=PGIMER";
 // var smsurl = "http://msdgweb.mgov.gov.in/esms/sendsmsrequest?username=PHD25PGIMER&password=sph@25&smsservicetype=unicodemsg&content=hyy&mobileno=8968999927&senderid=PGIMER";         
		   httpGet(smsurl);

	}
	
	

	
	function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "POST", theUrl, false );
    xmlHttp.send( null );
    return xmlHttp.responseText;
}

	
/*
	  httpGet = function (theUrl) {
        $.ajax({
                type: 'post',
                encoding: "UTF-8",
                dataType: "html",
                 contentType: 'application/x-www-form-urlencoded',
                url: theUrl,
                success: function (msg) {
                    //alert(msg);
                }

        })
	
     }

*/
	
   </script>
  

  </body>
  </html>