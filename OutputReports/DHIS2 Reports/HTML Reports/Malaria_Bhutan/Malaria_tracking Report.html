<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
    crossorigin="anonymous">

<style>
    tbody>tr>td {
        font-weight: bold;
    }

    thead>tr>td {
        font-weight: bold;
    }

    /* Add animation to "page content" */

    .animate-bottom {
        position: relative;
        -webkit-animation-name: animatebottom;
        -webkit-animation-duration: 1s;
        animation-name: animatebottom;
        animation-duration: 1s
    }

    @-webkit-keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }
        to {
            bottom: 0px;
            opacity: 1
        }
    }

    @keyframes animatebottom {
        from {
            bottom: -100px;
            opacity: 0
        }
        to {
            bottom: 0;
            opacity: 1
        }
    }

    */ #printing {
        display: none;
        text-align: center;
    }

    .table tbody+tbody {
        border-top: 1px solid black !important;
    }

    .table td,
    .table th {
        border-top: 1px solid black !important;
    }
</style>
<a id="dlink" style="display:none;"></a>


<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport" onclick="tableToExcel('tableid', 'name', 'Malaria case/foci tracking performance report, VDCP, Bhutan.xls')">
    <span class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span> &nbsp; Download As Excel
</button>
<div id="notPrint">
    <b style="margin-left: 30%">Start Date : </b>
    <input type="date" id="startDate" required> End Date :
    <input type="date" id="endDate" required>
    <br>
    <br>
    <br>
    <button onClick="weekDate()" id="genformA" style="margin-left: 50%">Generate</button>
    <br>
    <br>
</div>


<br>
<br>
<div id="loader"></div>
<div id="printing" class="animate-bottom">
    <div id='state'>
        <table width="100%" id="tableid" border="1" class="table  table-hover text-center">
            <thead>
                <tr colspan="35" style=" font-weight:400; text-align:center;">
                    <td colspan="20" style="border:1px solid black;background:#A9A9A9; ">Malaria case/foci tracking performance report, VDCP, Bhutan</td>
                    <td colspan="15" style="border:1px solid black;background:#A9A9A9; "> </td>
                </tr>
                <tr colspan="35" style=" font-weight:400; text-align:center;">
                    <td colspan="20" style="border:1px solid black;background:#A9A9A9; ">OrganisationUnit : -
                        <span id="ouname"> </span>
                    </td>
                    <td colspan="15" style="border:1px solid black;background:#A9A9A9; "> </td>


                </tr>

                <!-- <tr colspan="68" style=" font-weight:400; text-align:center;">
                <td colspan="10" style="border:1px solid black;background:#A9A9A9; "> From : - <span id="start"></span></td>
                <td colspan="10" style="border:1px solid black;background:#A9A9A9; "> To : - <span id="end"></span>
                </td>
                <td colspan="48" style="border:1px solid black;background:#A9A9A9; "> </td>
            </tr> -->

                <tr style=" font-weight:400; text-align:center;">
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">S.No</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Organisation Name
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total population
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total population in high risk area</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total population in low risk area</td>


                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total RDT test done</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total Microscopy</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Number of children under 5 years of age tested as malaria positive</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Number of cases above 5 years of age tested as malaria positive</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">% Plasmodium falciparum cases</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> % Plasmodium Vivax cases
                    </td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Malaria cases - Males</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> Malaria cases - Females</td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Inpatient admissions for malaria treatment
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> Number of malaria deaths</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Indigenous malaria cases
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Imported malaria cases</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Introduced malaria cases
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Relapse malaria cases</td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Induced malaria cases</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> Annual Parasite Incidence (API)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Annual Parasite Incidence (API) among high risk population (7 high transmission districts)
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> Annual Parasite Incidence (API) - Indigenous and Introduced cases among high risk population (7 high
                        transmission districts)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Annual Parasite Incidence (API) - Private Diagnostic Clinics
                    </td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Annual Blood Examination Rate (ABER)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Annual Blood Examination Rate (ABER) among high risk population (7 high transmission districts)
                    </td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Slide Positivity Rate (SPR)</td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Slide Positivity Rate (SPR) among high risk population (7 high transmission districts)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9"> Total Positivity Rate (TPR) - Private Diagnostic Clinics</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Confirmed malaria cases which were investigated and classified (%)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Confirmed malaria cases who received first-line antimalarial treatment according to National policy (%)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Confirmed malaria cases who received radical cure treatment (%)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Confirmed malaria cases with complete follow-up (%)</td>
                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Number of active malaria transmission foci identified </td>

                    <td style="border:1px solid black;text-align:center;background-color:#A9A9A9">Total number of new foci investigated</td>



                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

    </div>
</div>
<!-- printing script -->
<script type="text/javascript">
    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }

</script>



<!-- Main Script -->
<script>

    var startDate = '';
    var endDate = '';
    var per = '';

    function weekDate() {
        document.getElementById("tableid").tBodies[0].innerHTML = "";
        startDate1 = document.getElementById("startDate").value;
        endDate1 = document.getElementById("endDate").value;

        var s = startDate1.split('-');
        var ss = s.join('');
        var startmonth = ss.substr(0, 6);
        var e = endDate1.split('-');
        var ee = e.join('');
        var endmonth = ee.substr(0, 6);
        var date1 = ee.substr(0, 4);

        //  var monthCode = endmonth.substr(4, 6);
        // getMonth(monthCode);
        //  year = pe.substr(0, 4)

        startDate = moment(startDate1);
        endDate = moment(endDate1);
        var result = [];
        if (endDate.isBefore(startDate)) {
            window.alert('Please select end date Accordinlgy');
        }
        var currentDate = startDate.clone();
        while (currentDate.isBefore(endDate)) {
            result.push(currentDate.format("YYYYMM"));
            currentDate.add(1, 'month');
        }
        var date = ("" + result.join(";") + "");

        console.log(date);



        var periods = dhis2.report.periods;
        var period = periods[0];

        //var periodName = getPeriod(period);

        //document.getElementById('periodName').innerHTML = periodName;

        var url = window.location.href;
        var params = url.split('=');
        var gotOrgUnit = params[2];
        //var gotPeriod = params[2].toString().substring(0, 6);

        //document.getElementById('gotPeriod').innerHTML = gotPeriod;

        //var periodArray = getPeriods();
        //var periodcum = periodArray.toString();
        //var periodcumulative = periodcum.replace(/,/g, "");
        var selOrgUnitLevel = dhis2.report.organisationUnitHierarchy.length;






       


        


        var arrysort = [];




        var orgUnitChildren_Array = [];
        var orgUnitChildren_Array1 = [];
        var secondChildren_Array = [];
        var orgUnit = dhis2.report.organisationUnit;
        var orgUnitChildren = dhis2.report.organisationUnitChildren;
        var selOrgUnitLevel = dhis2.report.organisationUnitHierarchy.length;

        var count = 0;

        document.getElementById('ouname').innerHTML = orgUnit.name;



        $.each(orgUnitChildren, function (i, val) {
            orgUnitChildren_Array.push([val.id, val.name]);
        });
        if (gotOrgUnit == 'M8GJdp0OMEP') {
            orgunitArray();
        }
     else if (selOrgUnitLevel == 2 || selOrgUnitLevel == 3) {
            orgunitArray1();
        }
        else if (selOrgUnitLevel >3){
            alert("please select upper level");
        }







        function orgunitArray() {
            $.ajax({
                async: false,
                url: "../api/organisationUnits.json?level=3",
                success: function (data) {

                    for (var i = 0; i < data.organisationUnits.length; i++) {
                        orgUnitChildren_Array1.push([data.organisationUnits[i].id, data.organisationUnits[i].displayName]);

                    }
                }
            });
        }
        function orgunitArray1() {
            $.ajax({
                async: false,
                url: "../api/organisationUnits/" + gotOrgUnit + ".json?fields=id,name,children[id,name]",
                success: function (data) {

                    for (var i = 0; i < data.children.length; i++) {
                        orgUnitChildren_Array1.push([data.children[i].id, data.children[i].name]);

                    }
                }
            });
        }




        // New Code start from here

        var count1 = 0;

        orgUnitChildren_Array1.forEach(function (element, index) {
            var ouid = element[0];
            var ouidName = element[1];




            sample(ouid, ouidName, 1);
            if (orgUnitChildren_Array.length - 1 == index) {
                sample(ouid, ouidName, 0);
            }

        }, this)

        function datafordate(ouid, period) {
            var dataA = 0;
            $.ajax({
                async: false,
                url: "../api/dataValues.json?de=yl3ZGkjVbli&pe=" + period + "&ou=" + ouid + "",
                success: function (data) {
                    dataA = data[0];
                }
            });
            return dataA;
        }
        var count = 0;
        var value0 = 0;
        var value1 = 0;
        var value2 = 0;

        var value3 = 0;
        var value4 = 0;
        var value5 = 0;
        var value6 = 0;
        var value7 = 0;
        var value8 = 0;
        var value9 = 0;
        var value10 = 0;
        var value11 = 0;
        var value12 = 0;
        var value13 = 0;
        var value14 = 0;
        var value15 = 0;
        var value16 = 0;
        var value17 = 0;
        var value18 = 0;
        var value19 = 0;
        var value20 = 0;
        var value21 = 0;
        var value22 = 0;
        var value23 = 0;
        var value24 = 0;
        var value25 = 0;
        var value26 = 0;
        var value27 = 0;
        var value28 = 0;


        var tab1 = 0;
        var tab2 = 0;
        var tab3 = 0;
        var tab4 = 0;

          var value3_ = 0;
        var value4_ = 0;
        var value5_ = 0;
        var value6_ = 0;
        var value7_ = 0;
        var value8_ = 0;
        var value9_ = 0;
        var value10_ = 0;
        var value11_ = 0;
        var value12_ = 0;
        var value13_ = 0;
        var value14_ = 0;
        var value15_ = 0;
        var value16_ = 0;
        var value17_ = 0;
        var value18_ = 0;
        var value19_ = 0;
        var value20_ = 0;
        var value21_ = 0;
        var value22_ = 0;
        var value23_ = 0;
        var value24_ = 0;
        var value25_ = 0;
        var value26_ = 0;
        var value27_ = 0;
        var value28_ = 0;

        var tab1_ = 0;
        var tab2_ = 0;
        var tab3_ = 0;
        var tab4_ = 0;


        function sample(ouid, ouidName, count1) {

            var ENcount = 0;
            var ENcount1 = 0;
            var EN_C = 0;
            var systemidArray2 = [];
            var url = "";
            var url2 = "";
            systemidArray4 = [];
            systemidArray3 = [];
            

            $.when(
                $.getJSON("../api/26/analytics.json?dimension=ou:" + ouid + "&dimension=dx:bzpvelBGW19;xHmeaPrVIdi;HefuV5w8jYi;oyCVkcttzfB;VVBxrSxy4YQ;gKzEjgl9W7r;pc9XCow2Gib;b8bYcFERIwV;RPZPxX65Nk1;LwT8zrqm90m;QfVoLy0NZro;DPLiwbYSxkI;JPIZLXxWuje;ygnQ4PcFUtl;rg9hHmtyM9h;Uq9Tp9UDEvi;DBTSf4IHWjH;Sd3RUjYlsDL;feNqB53eYb6;ILLQk5BCObf;bZojnzkbvrZ;eM9uOtnN4Ms;sMmxHtvsUPG;zyTL3AMIkf2;d6Sr0B2NJYv;v860TXwRkPH;B1dnmloEfNq;&filter=pe:" + date + "&displayProperty=NAME&paging=false", {
                    format: "json"
                }),

                $.getJSON("../api/analytics.json?dimension=pe:" + date1 + "&dimension=dx:bzpvelBGW19;DBTSf4IHWjH;v860TXwRkPH;B1dnmloEfNq;feNqB53eYb6;&dimension=ou:" + ouid + "&displayProperty=NAME&ouMode=DESCENDANTS&paging=false", {
                    format: "json"
                }),
                $.getJSON("../api/analytics.json?dimension=ou:M8GJdp0OMEP&dimension=dx:bzpvelBGW19;xHmeaPrVIdi;HefuV5w8jYi;oyCVkcttzfB;VVBxrSxy4YQ;gKzEjgl9W7r;pc9XCow2Gib;b8bYcFERIwV;RPZPxX65Nk1;LwT8zrqm90m;QfVoLy0NZro;DPLiwbYSxkI;JPIZLXxWuje;ygnQ4PcFUtl;rg9hHmtyM9h;Uq9Tp9UDEvi;DBTSf4IHWjH;Sd3RUjYlsDL;feNqB53eYb6;ILLQk5BCObf;bZojnzkbvrZ;eM9uOtnN4Ms;sMmxHtvsUPG;zyTL3AMIkf2;d6Sr0B2NJYv;v860TXwRkPH;B1dnmloEfNq;DBTSf4IHWjH;v860TXwRkPH;B1dnmloEfNq;feNqB53eYb6&filter=pe:" + date + "&displayProperty=NAME", {
                    format: "json"
                }),
                $.getJSON("../api/analytics.json?dimension=pe:" + date1 + "&dimension=dx:bzpvelBGW19;xHmeaPrVIdi;HefuV5w8jYi;oyCVkcttzfB;VVBxrSxy4YQ;gKzEjgl9W7r;pc9XCow2Gib;b8bYcFERIwV;RPZPxX65Nk1;LwT8zrqm90m;QfVoLy0NZro;DPLiwbYSxkI;JPIZLXxWuje;ygnQ4PcFUtl;rg9hHmtyM9h;Uq9Tp9UDEvi;DBTSf4IHWjH;Sd3RUjYlsDL;feNqB53eYb6;ILLQk5BCObf;bZojnzkbvrZ;eM9uOtnN4Ms;sMmxHtvsUPG;zyTL3AMIkf2;d6Sr0B2NJYv;v860TXwRkPH;B1dnmloEfNq;DBTSf4IHWjH;v860TXwRkPH;B1dnmloEfNq;feNqB53eYb6&dimension=ou:M8GJdp0OMEP&displayProperty=NAME", {
                    format: "json"
                }),

                $.getJSON("../api/analytics.json?dimension=pe:" + date1 + "&dimension=dx:DBTSf4IHWjH;v860TXwRkPH;B1dnmloEfNq;feNqB53eYb6&filter=ou:OU_GROUP-w0y2eWQiAbw;M8GJdp0OMEP;keBvW7IyXli;LDTBV6f9x5j;GkBNgm5nJFM;uy9zZpHKaom;dhOvYypmAKV;PflI8FU0Rpd;aoQkCHSTvA2&displayProperty=NAME", {
                    format: "json"
                }),


               

                $.getJSON("../api/29/analytics/events/query/qDkgAbB5Jlk.json?dimension=pe:"+date1+"&dimension=ou:"+ouid+"&dimension=TfdH5KvFmMy&dimension=flGbXLXCrEo&dimension=vGxpKVMkmaW:IN:MIX;PF;PV&stage=hYyB7FUS5eR&displayProperty=NAME&outputType=EVENT&pageSize=100&page=1&outputIdScheme=UIDzˀ", {
                    format: "json"
                }),

                 $.getJSON( "../api/29/analytics/events/query/qDkgAbB5Jlk.json?dimension=pe:"+date1+"&dimension=ou:"+ouid+"&dimension=TfdH5KvFmMy&dimension=flGbXLXCrEo&dimension=xTvwqNmu4PH:IN:07;01;04;02;05;03;06&stage=cmRlfFEuo5d&displayProperty=NAME&outputType=EVENT&pageSize=100&page=1&outputIdScheme=UID", {
                    format: "json"
                }),

                 $.getJSON("../api/29/analytics/events/query/qDkgAbB5Jlk.json?dimension=pe:"+date1+"&dimension=ou:M8GJdp0OMEP&dimension=TfdH5KvFmMy&dimension=flGbXLXCrEo&dimension=vGxpKVMkmaW:IN:MIX;PF;PV&stage=hYyB7FUS5eR&displayProperty=NAME&outputType=EVENT&pageSize=100&page=1&outputIdScheme=UIDzˀ", {
                    format: "json"
                }),
                $.getJSON( "../api/29/analytics/events/query/qDkgAbB5Jlk.json?dimension=pe:"+date1+"&dimension=ou:M8GJdp0OMEP&dimension=TfdH5KvFmMy&dimension=flGbXLXCrEo&dimension=xTvwqNmu4PH:IN:07;01;04;02;05;03;06&stage=cmRlfFEuo5d&displayProperty=NAME&outputType=EVENT&pageSize=100&page=1&outputIdScheme=UID", {
                    format: "json"
                }),






                
            ).then(function (res4, res5, res6, res66, res7, result1,result2, result3, result4) {
                count++;
             
                finalvalue(res4, res5, res6, res66, res7,result1,result2,result3,result4, ouidName, count, count1, ouid);
            })

        }
    }







    var high_pop = 0;
    var low_pop = 0;
    var pop1 = 0;
    var pop2 = 0;
    var tot = 0;
  



    function finalvalue(res4, res5, res6, res66, res7, result1, result2,result3, result4, ouidName, count, count1, ouid) {


        if (count1 != 0) {

            value3 = datavalue1(res5, 'bzpvelBGW19');
            value4 = datavalue(res4, 'xHmeaPrVIdi');
            value5 = datavalue(res4, 'HefuV5w8jYi');
            value6 = datavalue(res4, 'oyCVkcttzfB');
            value7 = datavalue(res4, 'VVBxrSxy4YQ');
            //Date

            value8 = datavalue(res4, 'gKzEjgl9W7r');
            value9 = datavalue(res4, 'pc9XCow2Gib');
            value10 = datavalue(res4, 'b8bYcFERIwV');

            value11 = datavalue(res4, 'RPZPxX65Nk1');
            value12 = datavalue(res4, 'LwT8zrqm90m');
            value13 = datavalue(res4, 'QfVoLy0NZro');
            value14 = datavalue(res4, 'DPLiwbYSxkI');
            value15 = datavalue(res4, 'JPIZLXxWuje');

            value16 = datavalue(res4, 'ygnQ4PcFUtl');
            value17 = datavalue(res4, 'rg9hHmtyM9h');
            value18 = datavalue(res4, 'Uq9Tp9UDEvi');

            value19 = datavalue1(res5, 'DBTSf4IHWjH');
            value20 = datavalue(res4, 'Sd3RUjYlsDL');
            value21 = datavalue1(res5, 'B1dnmloEfNq');
            value22 = datavalue(res4, 'feNqB53eYb6');
            value23 = datavalue(res4, 'ILLQk5BCObf');
            value24 = datavalue(res4, 'bZojnzkbvrZ');
            value25 = datavalue(res4, 'eM9uOtnN4Ms');
            value26 = datavalue(res4, 'sMmxHtvsUPG');
            value27 = datavalue(res4, 'zyTL3AMIkf2');
            value28 = datavalue(res4, 'd6Sr0B2NJYv');

            tab1 = datavalue1(res5, 'DBTSf4IHWjH');
            tab2 = datavalue1(res5, 'v860TXwRkPH');
            tab3 = datavalue1(res5, 'B1dnmloEfNq');
            tab4 = datavalue1(res5, 'feNqB53eYb6');

            value3_ = datavalue1(res66, 'bzpvelBGW19');
            value4_ = datavalue(res6, 'xHmeaPrVIdi');
            value5_ = datavalue(res6, 'HefuV5w8jYi');
            value6_ = datavalue(res6, 'oyCVkcttzfB');
            value7_ = datavalue(res6, 'VVBxrSxy4YQ');
            //Date

            value8_ = datavalue(res6, 'gKzEjgl9W7r');
            value9_ = datavalue(res6, 'pc9XCow2Gib');
            value10_ = datavalue(res6, 'b8bYcFERIwV');

            value11_ = datavalue(res6, 'RPZPxX65Nk1');
            value12_ = datavalue(res6, 'LwT8zrqm90m');
            value13_ = datavalue(res6, 'QfVoLy0NZro');
            value14_ = datavalue(res6, 'DPLiwbYSxkI');
            value15_ = datavalue(res6, 'JPIZLXxWuje');

            value16_ = datavalue(res6, 'ygnQ4PcFUtl');
            value17_ = datavalue(res6, 'rg9hHmtyM9h');
            value18_ = datavalue(res6, 'Uq9Tp9UDEvi');

            value19_ = datavalue1(res66, 'DBTSf4IHWjH');
            value20_ = datavalue(res6, 'Sd3RUjYlsDL');
            value21_ = datavalue1(res66, 'B1dnmloEfNq');
            value22_ = datavalue(res6, 'feNqB53eYb6');
            value23_ = datavalue(res6, 'ILLQk5BCObf');
            value24_ = datavalue(res6, 'bZojnzkbvrZ');
            value25_ = datavalue(res6, 'eM9uOtnN4Ms');
            value26_ = datavalue(res6, 'sMmxHtvsUPG');
            value27_ = datavalue(res6, 'zyTL3AMIkf2');
            value28_ = datavalue(res6, 'd6Sr0B2NJYv');

            tab1_ = datavalue(res7, 'DBTSf4IHWjH');
            tab2_ = datavalue(res7, 'v860TXwRkPH');
            tab3_ = datavalue(res7, 'B1dnmloEfNq');
            tab4_ = datavalue(res7, 'feNqB53eYb6');
            var systemidArray1 = [];
            var systemidArray2 = [];
            var systemidArray3 = [];
            var systemidArray4 = [];

        for (let i = 0; i < result1[0].rows.length; i++) {
                    if (result1[0].rows[i][10] == "PV" || result1[0].rows[i][10] == "MIX") {
                        if (systemidArray1.indexOf(result1[0].rows[i][9]) === -1) {
                            systemidArray1.push(result1[0].rows[i][9]);
                        }
                    } else if (result1[0].rows[i][10] == "PF") {
                        if (systemidArray2.indexOf(result1[0].rows[i][9]) === -1) {
                            systemidArray2.push(result1[0].rows[i][9]);
                        }
                    }

                    if (i == result1[0].rows.length - 1) {
                        var counter = checkFunction(result2[0].rows, systemidArray1, systemidArray2);
                        console.log("counter" +counter);
                    }
                }

                if(counter == "undefined" || counter == undefined){
                    counter= 0;
                }

                 








            // var high_pop = 0;
            // var low_pop = 0;

            if (value19 > 1) {
                high_pop = parseInt(value3);

            }
            else {
                low_pop = parseInt(value3);
            }



            if ((ouid == "RkbSaHzKUcF" || ouid == "mC0E5uPIw3l" || ouid == "bcH85UzbhuZ" || ouid == "uo9DluzdBQC" || ouid == "DHmpnUaqiOP" || ouid == "IKBWZvSw9ak" || ouid == "w5NndqPaExZ" || ouid == "x6bTYIX73Jr" || ouid == "oyBx4UTjw2M" || ouid == "r8kMZjD5bmz" || ouid == "r5Ps4CtLunI" || ouid == "Bt2pMRrBHeq" || ouid == "GqIj20dhpSt")) {
                tab1 = " ";
            }

            if ((ouid == "RkbSaHzKUcF" || ouid == "mC0E5uPIw3l" || ouid == "bcH85UzbhuZ" || ouid == "uo9DluzdBQC" || ouid == "DHmpnUaqiOP" || ouid == "IKBWZvSw9ak" || ouid == "w5NndqPaExZ" || ouid == "x6bTYIX73Jr" || ouid == "oyBx4UTjw2M" || ouid == "r8kMZjD5bmz" || ouid == "r5Ps4CtLunI" || ouid == "Bt2pMRrBHeq" || ouid == "GqIj20dhpSt")) {

                tab2 = " ";
            }


            if ((ouid == "RkbSaHzKUcF" || ouid == "mC0E5uPIw3l" || ouid == "bcH85UzbhuZ" || ouid == "uo9DluzdBQC" || ouid == "DHmpnUaqiOP" || ouid == "IKBWZvSw9ak" || ouid == "w5NndqPaExZ" || ouid == "x6bTYIX73Jr" || ouid == "oyBx4UTjw2M" || ouid == "r8kMZjD5bmz" || ouid == "r5Ps4CtLunI" || ouid == "Bt2pMRrBHeq" || ouid == "GqIj20dhpSt")) {

                tab3 = " ";
            }

            if ((ouid == "RkbSaHzKUcF" || ouid == "mC0E5uPIw3l" || ouid == "bcH85UzbhuZ" || ouid == "uo9DluzdBQC" || ouid == "DHmpnUaqiOP" || ouid == "IKBWZvSw9ak" || ouid == "w5NndqPaExZ" || ouid == "x6bTYIX73Jr" || ouid == "oyBx4UTjw2M" || ouid == "r8kMZjD5bmz" || ouid == "r5Ps4CtLunI" || ouid == "Bt2pMRrBHeq" || ouid == "GqIj20dhpSt")) {

                tab4 = " ";
            }


         


            var tabledata = '<tr>';

            tabledata += ("<td id = 'tableid' style = 'border-top:1px solid black'>" + count + "</td><td style = 'border-top:1px solid black'>" + ouidName +
                "</td><td style = 'border-top:1px solid black'>" + value3 +
                "</td><td style = 'border-top:1px solid black'>" + high_pop +
                "</td><td style = 'border-top:1px solid black'>" + low_pop +
                "</td><td style = 'border-top:1px solid black'>" + value4 +
                "</td><td style = 'border-top:1px solid black'>" + value5 +
                "</td><td style = 'border-top:1px solid black'>" + value6 +
                "</td><td style = 'border-top:1px solid black'>" + value7 +
                "</td><td style = 'border-top:1px solid black'>" + value8 +
                "</td><td style = 'border-top:1px solid black'>" + value9 +
                "</td><td style = 'border-top:1px solid black'>" + value10 +
                "</td><td style = 'border-top:1px solid black'>" + value11 +
                "</td><td style = 'border-top:1px solid black'>" + value12 +
                "</td><td style = 'border-top:1px solid black'>" + value13 +
                "</td><td style = 'border-top:1px solid black'>" + value14 +
                "</td><td style = 'border-top:1px solid black'>" + value15 +
                "</td><td style = 'border-top:1px solid black'>" + value16 +
                "</td><td style = 'border-top:1px solid black'>" + value17 +
                "</td><td style = 'border-top:1px solid black'>" + value18 +
                "</td><td style = 'border-top:1px solid black'>" + value19 +
                "</td><td style = 'border-top:1px solid black'>" + tab1 +
                "</td><td style = 'border-top:1px solid black'>" + tab2 +
                "</td><td style = 'border-top:1px solid black'>" + value20 +
                "</td><td style = 'border-top:1px solid black'>" + value21 +
                "</td><td style = 'border-top:1px solid black'>" + tab3 +
                "</td><td style = 'border-top:1px solid black'> " + value22 +
                "</td><td style = 'border-top:1px solid black'>" + tab4 +
                "</td><td style = 'border-top:1px solid black'>" + value23 +
                "</td><td style = 'border-top:1px solid black'>" + value24 +
                "</td><td style = 'border-top:1px solid black'>" + value25 +
                "</td><td style = 'border-top:1px solid black'>" + value26 +
                "</td><td style = 'border-top:1px solid black'>" + counter + "</td><td style = 'border-top:1px solid black'>" + value27 +
                "</td><td style = 'border-top:1px solid black'>" + value28 + "</td>");

            tabledata += "</tr>";



            document.getElementById("tableid").tBodies[0].innerHTML += tabledata;
            document.getElementById("loader").style.display = "none";
            document.getElementById("printing").style.display = "block";


            pop1 += high_pop;
            pop2 += low_pop;
            tot += EN_C;

            EN_C = 0;
            ENcount = 0;
            ENcount1 = 0;
            counter = 0;
            

        }

        else if (count1 == 0) {
            systemidArray3 = [];
            systemidArray4 =[];

               for (let p = 0; p < result3[0].rows.length; p++) {
                    if (result3[0].rows[p][10] == "PV" || result3[0].rows[p][10] == "MIX") {
                        if (systemidArray3.indexOf(result3[0].rows[p][9]) === -1) {
                            systemidArray3.push(result3[0].rows[p][9]);
                        }
                    } else if (result3[0].rows[p][10] == "PF") {
                        if (systemidArray4.indexOf(result3[0].rows[p][9]) === -1) {
                            systemidArray4.push(result3[0].rows[p][9]);
                        }
                    }

                    if (p == result3[0].rows.length - 1) {
                        var counter1 = checkFunction(result4[0].rows, systemidArray3, systemidArray4);
                        console.log("counter" +counter1);
                        if(counter1 == "undefined" || counter1 == undefined){
                            counter1 = 0;
                        }
                      
                        console.log("counter1"+ counter1);
                    }
                }

            

            setTimeout(function () {
            

                tabledata = ("<tr  id = 'tableid' style='background:#ADD8E6'><td colspan='2'>Bhutan</td><td>" + value3_ + " </td><td>" + pop1 + "</td><td>" + pop2 + "</td><td>" + value4_ + "</td><td>" + value5_ + "</td><td>" + value6_ + "</td><td>" + value7_ + "</td><td>" + value8_ + "</td><td>" + value9_ + "</td><td>" + value10_ + "</td><td>" + value11_ + "</td><td>" + value12_ + "</td><td>" + value13_ + "</td><td>" + value14_ + "</td><td>" + value15_ + "</td><td>" + value16_ + "</td><td>" + value17_ + "</td><td>" + value18_ + "</td><td>" + value19_ + "</td><td>" + tab1_ + "</td><td>" + tab2_ + "</td><td>" + value20_ + "</td><td>" + value21_ + "</td><td>" + tab3_ + "</td><td>" + value22_ + "</td><td>" + tab4_ + "</td><td>" + value23_ + "</td><td>" + value24_ + "</td><td>" + value25_ + "</td><td>" + value26_ + "</td><td>" + counter1 + "</td><td> " + value27_ + " </td><td>" + value28_ + "</td></tr>");

                document.getElementById("tableid").innerHTML += tabledata;


            }, 1000);


        }









    }

function datavalue1(dataJSON, id) {
    var value1 = 0;
    for (var i = 0; i < dataJSON[0].rows.length; i++) {
        if (dataJSON[0].rows[i][0] == id) {
            value1 = dataJSON[0].rows[i][3];
        }
    }
    return (value1);
}


function datavalue(dataJSON, id) {
    var value1 = 0;
    for (var i = 0; i < dataJSON[0].rows.length; i++) {
        if (dataJSON[0].rows[i][0] == id) {
            value1 = dataJSON[0].rows[i][2];
            
        }
    }
    return (value1);
}
function datavalue3(dataJSON, id) {
    var value1 = 0;
    for (var i = 0; i < dataJSON[0].rows.length; i++) {
        if (dataJSON[0].rows[i][0] == id) {
            value1 = dataJSON[0].rows[i][3];
            
        }
    }
    return (value1);
}


          var checkFunction = function (arr, ids1, ids2) {
            // console.log(ids);
            var count = 0;
            for (let k = 0; k < ids1.length; k++) {
                var flag1 = false,
                    flag2 = false,
                    flag3 = false,
                    flag4 = false,
                    flag5 = false,
                    flag6 = false,
                    flag7 = false;
                for (let j = 0; j < arr.length; j++) {
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "01") {
                        flag1 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "02") {
                        flag2 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "03") {
                        flag3 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "04") {
                        flag4 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "05") {
                        flag5 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "06") {
                        flag6 = true;
                    }
                    if (arr[j].includes(ids1[k]) && arr[j][10] == "07") {
                        flag7 = true;
                    }
                }
                if (flag1 && flag2 && flag3 && flag4 && flag5 && flag6 && flag7) {
                    count++;
                    console.log(count);
                }
            }
            for (let k = 0; k < ids2.length; k++) {
                var flag11 = false,
                    flag22 = false,
                    flag33 = false,
                    flag55 = false;
                for (let j = 0; j < arr.length; j++) {
                    if (arr[j].includes(ids2[k]) && arr[j][10] == "01") {
                        flag11 = true;
                    }
                    if (arr[j].includes(ids2[k]) && arr[j][10] == "02") {
                        flag22 = true;
                    }
                    if (arr[j].includes(ids2[k]) && arr[j][10] == "03") {
                        flag33 = true;
                    }
                    if (arr[j].includes(ids2[k]) && arr[j][10] == "05") {
                        flag55 = true;
                    }
                }
                if (flag11 && flag22 && flag33 &&flag55)  {
                    count++;
                }
            }

            return count;
        };




    // function arraySorting(a, b) {
    //     return ((a[1] < b[1]) ? -1 : ((a[1] > b[1]) ? 1 : 0));
    // }




    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,'
            , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
        return function (table, name, filename) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }

            document.getElementById("dlink").href = uri + base64(format(template, ctx));
            document.getElementById("dlink").download = filename;
            document.getElementById("dlink").click();

        }
    })()


</script>