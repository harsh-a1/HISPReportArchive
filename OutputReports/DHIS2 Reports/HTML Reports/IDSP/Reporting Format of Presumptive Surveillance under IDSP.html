<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ"
crossorigin="anonymous">

<style>
tbody>tr>td {
    font-weight: bold;
}
thead>tr>td {
    font-weight: bold;
}

/* Add animation to "page content" */

.animate-bottom {
    position: relative;
    -webkit-animation-name: animatebottom;
    -webkit-animation-duration: 1s;
    animation-name: animatebottom;
    animation-duration: 1s
}

@-webkit-keyframes animatebottom {
    from {
        bottom: -100px;
        opacity: 0
    }
    to {
        bottom: 0px;
        opacity: 1
    }
}

@keyframes animatebottom {
    from {
        bottom: -100px;
        opacity: 0
    }
    to {
        bottom: 0;
        opacity: 1
    }
}

*/ #printing {
    display: none;
    text-align: center;
}
.table tbody+tbody{
	border-top: 1px solid black!important;
}

.table td, .table th{
	border-top : 1px solid black!important;
}
</style>
<a id="dlink" style="display:none;"></a>


<button type="button" class="btn btn-success btn-sm" style="vertical-align: middle;" id="btnExport" onclick="tableToExcel('tableid', 'name', 'Reporting_Format_of_Presumptive_Surveillance_under_IDSP.xls')"><span class="glyphicon glyphicon-download-alt" style="font-size: 15px;"></span> &nbsp;
Download As Excel
</button>
<div id="notPrint">
                    <b style="margin-left: 30%">Start Date : </b><input type="date" id="startDate" required>
                  End Date : <input type="date" id="endDate"required> <br><br><br>
				  <button onClick="weekDate()" id="genformA" style="margin-left: 50%">Generate</button><br><br>
                </div>
                    

<br><br>
<div id="loader"></div>
<div id="printing" style="display:none;" class="animate-bottom">
<div id='state'>
    <table id="tableid" border="1" class="table  table-hover text-center" cellspacing="6" cellpadding="4">
            <thead style=" font-weight:400; text-align:center;">
           <tr style=" font-weight:400; text-align:center;">
<td colspan="45" style="background:#ADD8E6;  text-align:center; border:1px solid black;" width="2861" >Reporting Format of Presumptive Surveillance under IDSP</td>

</tr>
<tr style=" font-weight:400; text-align:center;">
<td colspan="6" style="border:1px solid black;background:#ADD8E6; " >Organisationunit  : - <span id = "ouname"> </span></td>
<td colspan="6" style="border:1px solid black;background:#ADD8E6; " >Start Date  : - <span id = "start"> </span></td>
<td colspan="6" style="border:1px solid black;background:#ADD8E6; " >End date : - <span id = "end" > </span></td>
<td colspan="27" style="border:1px solid black;background:#ADD8E6; " >&nbsp;</td>



<tr style=" font-weight:400; text-align:center;">
<td  style="border:1px solid black;background:#ADD8E6; " >Sl.No&nbsp;</td>
  <td width="142" style="border:1px solid black;background:#ADD8E6; " >Name of the RU</td>
<td  width="68" style="border:1px solid black;background:#ADD8E6; " >Acute Diarrhoeal disease (Inlcuding acute gasrtoenteritis)</td>
<td width="49" style="border:1px solid black;background:#ADD8E6; " >Baciliary Dysentery</td>
<td  width="44" style="border:1px solid black;background:#ADD8E6; " >Viral Hepatitis</td>
<td  width="45" style="border:1px solid black;background:#ADD8E6; " >Enteric Fever</td>
<td  width="48" style="border:1px solid black;background:#ADD8E6; " >Malaria</td>
<td  width="55" style="border:1px solid black;background:#ADD8E6; " >Dengue/DHF/DSS</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Chikunguniya</td>
<td  width="49" style="border:1px solid black;background:#ADD8E6; " >Acute Encephalitis Syndrome</td>
<td  width="45" style="border:1px solid black;background:#ADD8E6; " >Meningitis</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Measles</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Diptheria</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Pertussis</td>
<td  width="44" style="border:1px solid black;background:#ADD8E6; " >Chicken Pox</td>
<td  width="55" style="border:1px solid black;background:#ADD8E6; " >Fever of Unknown Origin (PUO)</td>
<td  width="61" style="border:1px solid black;background:#ADD8E6; " >Acute Respiratory Infection (ARI) /Influenza Like</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Pneumonia</td>
<td  width="47" style="border:1px solid black;background:#ADD8E6; " >Leptospirosis</td>
<td  width="56" style="border:1px solid black;background:#ADD8E6; " >Acute Flaccid Paralysis &lt;15 years of Age</td>
<td width="47" style="border:1px solid black;background:#ADD8E6; " >Dog Bite</td>
<td  width="48" style="border:1px solid black;background:#ADD8E6; " >Snake Bite</td>
<td width="45" style="border:1px solid black;background:#ADD8E6; " >Scrub Typhus</td>
<td  width="54" style="border:1px solid black;background:#ADD8E6; " >Only fever &lt; 7 days</td>
<td  width="61" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Only fever &ge; 7 days</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Fever with rash</td>
<td  width="99" style="border:1px solid black;background:#ADD8E6; " >Fever with bleeding</td>
<td width="106" style="border:1px solid black;background:#ADD8E6; " >Fever with confused state/Semi- consciousness/Unconsciousness</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Fever with cough &lt;2 weeks</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Fever with cough &gt;2 weeks</td>
<td width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Jaundice</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;&nbsp;Animal bite</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Severe Acute Respiratory&nbsp;&nbsp; Infection(SARI) including Pneumonia</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Anthrax</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp;Kyasanur Forest Disease</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Crimean-Congo Haemorrhagic Fever</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Acute Hepatitis</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >&nbsp; Mumps</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Viral fever</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Unusual Syndromes NOT Captured above (Specify clinical diagnosis)</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >Total New OPD attendence (Not to be filled up when data collected for indoor cases)</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >State specific-Disease name I_IDSP P form</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; " >State specific-Disease name II_IDSP P form</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; ">State specific-Disease name III_IDSP P form</td>
<td  width="73" style="border:1px solid black;background:#ADD8E6; ">State specific-Disease name IV_IDSP P form</td>
</tr>
            </thead>
			<tbody>
			</tbody>
    </table>

</div>
</div>
<!-- printing script -->
<script type="text/javascript">
function printContent(el) {
    var restorepage = document.body.innerHTML;
    var printcontent = document.getElementById(el).innerHTML;
    document.body.innerHTML = printcontent;
    window.print();
    document.body.innerHTML = restorepage;
}

</script>



<!-- Main Script -->
<script>

 var startDate = '';
 var endDate = '';
 var per = '';
 
 function weekDate(){
 document.getElementById("tableid").tBodies[0].innerHTML = "";
  startDate = document.getElementById("startDate").value;
	 endDate = document.getElementById("endDate").value;
         per =  weekly(startDate,endDate);
		  console.log("per" + per);
		 
		  document.getElementById('start').innerHTML = startDate;
		 document.getElementById('end').innerHTML = endDate;
		 
		 
var periods = dhis2.report.periods;
var period = periods[0];

//var periodName = getPeriod(period);

//document.getElementById('periodName').innerHTML = periodName;

var url = window.location.href;
var params = url.split('=');
var gotOrgUnit = params[3];
//var gotPeriod = params[2].toString().substring(0, 6);

 //document.getElementById('gotPeriod').innerHTML = gotPeriod;
 
//var periodArray = getPeriods();
//var periodcum = periodArray.toString();
//var periodcumulative = periodcum.replace(/,/g, "");
var selOrgUnitLevel = dhis2.report.organisationUnitHierarchy.length;






var count = 0;
    var value0 = 0;
    var value1 = 0;
    var value2 = 0;

    var value3 = 0;
    var value4 = 0;
    var value5 = 0;
    var value6 = 0;
    var value7 = 0;
    var value8 = 0;
    var value9 = 0;
    var value10 = 0;
    var value11 = 0;
    var value12 = 0;
    var value13 = 0;
    var value14 = 0;
    var value15 = 0;
    var value16 = 0;
    var value17 = 0;
    var value18 = 0;
    var value19 = 0;
    var value20 = 0;
    var value21 = 0;
    var value22 = 0;
    var value23 = 0;
    var value24 = 0;
    var value25 = 0;
    var value26 = 0;
    var value27 = 0;
    var value28 = 0;
    var value29 = 0;
    var value30 = 0;
    var value31 = 0;
    var value32 = 0;
    var value33 = 0;
    var value34 = 0;
    var value35 = 0;
    var value36 = 0;
    var value37 = 0;
    var value38 = 0;
    var value39 = 0;
    var value40 = 0;
    var value41 = 0;
    var value42 = 0;
    var value43 = 0;
    var value44 = 0;
    var value45 = 0;
    var value46 = 0;
    var value47 = 0;
    var value48 = 0;
    var value49 = 0;
    var value50 = 0;
    var value51 = 0;
    var value52 = 0;
    var value53 = 0;
    var value54 = 0;
    var value55 = 0;
    var value56 = 0;
    var value57 = 0;
    var value58 = 0;
    var value59 = 0;

    var value60 = 0;
    var value61 = 0;
    var value62 = 0;
    var value63 = 0;
    var value64 = 0;
    var value65 = 0;
    var value66 = 0;

    var value67 = 0;
    var value68 = 0;
    var value69 = 0;
    var value70 = 0;
    var value71 = 0;

    var value72 = 0;
    var value73 = 0;
    var value74 = 0;
    var value75 = 0;
    var value76 = 0;




var orgUnitChildren_Array = [];
var secondChildren_Array = [];
var orgUnit = dhis2.report.organisationUnit;
var orgUnitChildren = dhis2.report.organisationUnitChildren;
var selOrgUnitLevel = dhis2.report.organisationUnitHierarchy.length;

var count = 0;

document.getElementById('ouname').innerHTML = orgUnit.name;



$.each(orgUnitChildren, function (i, val) {
    orgUnitChildren_Array.push([val.id, val.name]);
});
orgUnitChildren_Array.sort(arraySorting);



// New Code start from here

var count1 = 0;

orgUnitChildren_Array.forEach(function (element, index) {
    var ouid = element[0];
    var ouidName = element[1];
    sample(ouid, ouidName, 1);
    if (orgUnitChildren_Array.length - 1 == index) {
        sample(ouid, ouidName, 0);
    }

}, this)

function datafordate(ouid, period) {
    var dataA = 0;
    $.ajax({
        async: false,
        url: "../api/dataValues.json?de=yl3ZGkjVbli&pe=" + period + "&ou=" + ouid + "",
        success: function (data) {
            dataA = data[0];
        }
    });
    return dataA;
}


function sample(ouid, ouidName, count1) {
    $.when(
        $.getJSON("../api/25/analytics.json?dimension=dx:LTeV9L4vlQL;rVXyMFXPpqb;dOrVo8a6I1F;W43B61XBuD6;UUGlCs9YVPR;CdSYY7mvgsL;Z3nOat2GKGZ;FVoAIXoanNk;Hfd8RC0Da9A;J1TmEzPIqjK;bduKjaplDIl;XRT3woz0alE;IBmgYMKyeE9;jzqu1nRNKVe;jznTQqqjBrp;HDJrmbxOHkw;KupSJIz5rXb;nckunzCCYG6;K356s4xE8ev;xzHlCzdF8V6;Z6mcse9P2Gz;lVY7xYo8u9h;pjbMeHyzCLk;NZWc9RaojlN;aGeCqDK0zOZ;SQghFVQSjMy;LxZQFoBa54e;QtqMCM0FPNZ;nBDsQ5L6Y8y;HF2d7Be2iIZ;eG0mqcJlJII;dSWTRRg5LEe;AHTmFpFWCz8;ZsL6PWc3i3W;pwsIecnaCWc;IqnD1QQwMcf;oeFIlGZpkca;LO7vTAFuofc;klS6HNLJLql;CmB4BXn1TRC;UKdgi6mtKAF;v1STDVxA98L;IeBlnIdnBpK&dimension=ou:" + ouid + "&filter=pe:" + per + "&displayProperty=NAME", {
            format: "json"
        })
    
    ).then(function (res4, res5) {
        count++;
        finalvalue(res4, res5, ouidName, count, count1);
    })
}
}



function finalvalue(res4, res5, ouidName, count, count1) {

    if (count1 != 0) {

         value3 = datavalue(res4, 'LTeV9L4vlQL');
            value4 = datavalue(res4, 'rVXyMFXPpqb');
            value5 = datavalue(res4, 'dOrVo8a6I1F');
            value6 = datavalue(res4, 'W43B61XBuD6');
            value7 = datavalue(res4, 'UUGlCs9YVPR');
            //Date
            value8 = datavalue(res4, 'CdSYY7mvgsL');
            value9 = datavalue(res4, 'Z3nOat2GKGZ');
            value10 = datavalue(res4, 'FVoAIXoanNk');

            value11 = datavalue(res4, 'Hfd8RC0Da9A');
            value12 = datavalue(res4, 'J1TmEzPIqjK');
            value13 = datavalue(res4, 'bduKjaplDIl');
            value14 = datavalue(res4, 'XRT3woz0alE');
            value15 = datavalue(res4, 'IBmgYMKyeE9');

            value16 = datavalue(res4, 'jzqu1nRNKVe');
            value17 = datavalue(res4, 'jznTQqqjBrp');
            value18 = datavalue(res4, 'HDJrmbxOHkw');
            value19 = datavalue(res4, 'KupSJIz5rXb');
            value20 = datavalue(res4, 'nckunzCCYG6');
            value21 = datavalue(res4, 'K356s4xE8ev');
            value22 = datavalue(res4, 'xzHlCzdF8V6');
            value23 = datavalue(res4, 'Z6mcse9P2Gz');
            value24 = datavalue(res4, 'lVY7xYo8u9h');
            value25 = datavalue(res4, 'pjbMeHyzCLk');
            value26 = datavalue(res4, 'NZWc9RaojlN');
 value27 = datavalue(res4, 'aGeCqDK0zOZ');
            value28 = datavalue(res4, 'SQghFVQSjMy');
            value29 = datavalue(res4, 'LxZQFoBa54e');
            value30 = datavalue(res4, 'QtqMCM0FPNZ');
            value31 = datavalue(res4, 'nBDsQ5L6Y8y');
            value32 = datavalue(res4, 'HF2d7Be2iIZ');
            value33 = datavalue(res4, 'eG0mqcJlJII');
            value34 = datavalue(res4, 'dSWTRRg5LEe');
		
            value35 = datavalue(res4, 'AHTmFpFWCz8');
            value36 = datavalue(res4, 'ZsL6PWc3i3W');
            value37 = datavalue(res4, 'pwsIecnaCWc');

            value38 = datavalue(res4, 'IqnD1QQwMcf');
            value39 = datavalue(res4, 'oeFIlGZpkca');
            value40 = datavalue(res4, 'LO7vTAFuofc');
            value41 = datavalue(res4, 'klS6HNLJLql');
            value42 = datavalue(res4, 'CmB4BXn1TRC');
            value43 = datavalue(res4, 'UKdgi6mtKAF');
            value44 = datavalue(res4, 'v1STDVxA98L');
            value45 = datavalue(res4, 'IeBlnIdnBpK');
          
           
            var tabledata = '<tr>';

                    tabledata +=  ("<td id = 'tableid' style = 'border-top:1px solid black'>" + count + "</td><td style = 'border-top:1px solid black'>" + ouidName + "</td><td style = 'border-top:1px solid black'>" + value3 + "</td><td style = 'border-top:1px solid black'>" + value4 + "</td><td style = 'border-top:1px solid black'>" + value5 + "</td><td style = 'border-top:1px solid black'>" + value6 + "</td><td style = 'border-top:1px solid black'>" + value7 + "</td><td style = 'border-top:1px solid black'>" + value8 + "</td><td style = 'border-top:1px solid black'>" + value9 + "</td><td style = 'border-top:1px solid black'>" + value10 + "</td><td style = 'border-top:1px solid black'>" + value11 + "</td><td style = 'border-top:1px solid black'>" + value12 + "</td><td style = 'border-top:1px solid black'>" + value13 + "</td><td style = 'border-top:1px solid black'>" + value14 + "</td><td style = 'border-top:1px solid black'>" + value15 + "</td><td style = 'border-top:1px solid black'>" +  value16 + "</td><td style = 'border-top:1px solid black'>" + value17 + "</td><td style = 'border-top:1px solid black'>" + value18 + "</td><td style = 'border-top:1px solid black'>" + value19 + "</td><td style = 'border-top:1px solid black'>" + value20 + "</td><td style = 'border-top:1px solid black'>" + value21 + "</td><td style = 'border-top:1px solid black'> " + value22 + "</td><td style = 'border-top:1px solid black'>" + value23 + "</td><td style = 'border-top:1px solid black'>" + value24 + "</td><td style = 'border-top:1px solid black'>" + value25 + "</td><td style = 'border-top:1px solid black'>" + value26 + "</td><td style = 'border-top:1px solid black'>" + value27 + "</td><td style = 'border-top:1px solid black'>" + value28 + "</td><td style = 'border-top:1px solid black' >" + value29 + "</td><td style = 'border-top:1px solid black'>" + value30 + "</td><td style = 'border-top:1px solid black'>" + value31 + "</td><td style = 'border-top:1px solid black'>" + value32 + "</td><td style = 'border-top:1px solid black'>" + value33 + "</td><td style = 'border-top:1px solid black'>" + value34 + "</td><td style = 'border-top:1px solid black'>" + value35 + "</td><td style = 'border-top:1px solid black'>" + value36 + "</td><td style = 'border-top:1px solid black'>" + value37 + "</td><td style = 'border-top:1px solid black'>" + value38 + "</td><td style = 'border-top:1px solid black'>" + value39 + "</td><td style = 'border-top:1px solid black'>" + value40 + "</td ><td style = 'border-top:1px solid black'>" + value41 + "</td><td style = 'border-top:1px solid black'>" + value42 + "</td><td style = 'border-top:1px solid black'>" + value43 + "</td><td style = 'border-top:1px solid black'>" + value44 + "</td><td style = 'border-top:1px solid black'>" + value45 + "</td>");
					
                        tabledata += "</tr>";
                   
        
           document.getElementById("tableid").tBodies[0].innerHTML += tabledata;
        document.getElementById("loader").style.display = "none";
        document.getElementById("printing").style.display = "block";

       

    }
 

}


function datavalue(dataJSON, id) {
    var value1 = 0;
    for (var i = 0; i < dataJSON.rows.length; i++) {
        if (dataJSON.rows[i][0] == id) {
            value1 = parseInt(dataJSON.rows[i][2]);
        }
    }
    return (value1);
}


function datavalue1(dataJSON, id, id1) {
    var value1 = 'No';
    for (var i = 0; i < dataJSON.rows.length; i++) {
        if (dataJSON.rows[i][0] == id) {
            value1 = 'Yes';
        }
    }
    return (value1);
}


function arraySorting(a, b) {
    return ((a[1] < b[1]) ? -1 : ((a[1] > b[1]) ? 1 : 0));
}




var tableToExcel = (function () {
    var uri = 'data:application/vnd.ms-excel;base64,'
        , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
        , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
        , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
    return function (table, name, filename) {
        if (!table.nodeType) table = document.getElementById(table)
        var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }

        document.getElementById("dlink").href = uri + base64(format(template, ctx));
        document.getElementById("dlink").download = filename;
        document.getElementById("dlink").click();

    }
})()

function weekly(sD , eD)
{
   var unchangedStartDate = new Date(sD);
   var startDate = new Date(sD);
   var endDate = new Date(eD);

   //making start date's day to the prior Monday
   if(startDate.getDay() == 0)
       startDate.setDate(startDate.getDate()-6);
   else if(startDate.getDay()>1)
       startDate.setDate(startDate.getDate()-startDate.getDay()+1);

   //making start date's day to the prior Sunday
   endDate.setDate(endDate.getDate()-endDate.getDay());

   // *****************************************************************************************

   // date for looping
   var sDate = new Date(sD);
   sDate.setDate(1);
   sDate.setMonth(0);
   var dateString = "Select Period";

   //making start date's day to the first Monday of the year or last Monday of the previous year
   if(sDate.getDay() == 0)
       sDate.setDate(sDate.getDate()-6);
   else if(sDate.getDay()>1)
       sDate.setDate(sDate.getDate()-sDate.getDay()+1);

   var week = 0;
   var year = "";

   var isFirstIteration = true;

   while(sDate <= endDate)
   {

       var dummyYear = sDate.getFullYear();

       if(isFirstIteration)
           year = unchangedStartDate.getFullYear();
       else
           year = sDate.getFullYear();

       week++;

       if( sDate.getDate() == startDate.getDate() && sDate.getMonth() == startDate.getMonth() && sDate.getFullYear() == startDate.getFullYear())
       {
           var dhisDate = ( week > 9 ) ? ( year + "W" + week ) : ( year + "W" + week );
           startDate = sDate;
           dateString = ( dateString == "" ) ? dhisDate : ( dateString + ";" + dhisDate);
       }

       sDate.setDate(sDate.getDate()+7);
       if( dummyYear < sDate.getFullYear() && !isFirstIteration)
           week = 0;

       if(isFirstIteration)
           isFirstIteration = false;
   }
   
   var fields = dateString.split(';');

var name = fields[0];
var street = fields[1];


  
   return street;
}


</script>